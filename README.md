##  Developing Blockchain Use Cases Spring 2024 Lab 2
### Carnegie Mellon University
### Due: Monday, April 8, 2024 11:59 PM
### 10 Points
### Deliverable: A single .pdf file named Lab2.pdf with clearly labelled answers.

**Learning Objectives:**

In Part A, we will work **without a smart contract**. We will start the Hardhat
network in its own shell and interact with the shell via a Javascript program.
Part A illustrates client server computing and a simple decentralized payment system.

In Part B, we will work with an **ERC20 token contract**. ERC20 tokens are at the heart
of many DeFi applications.

**Deliverable:**

Please compile your answers to questions E0 through E31 into a single PDF file named ‘Lab2.pdf’. Ensure that the file is well-organized and properly labeled. Submit this single PDF file to Canvas.

## Part A. Writing a client side program to interact with a Hardhat network running locally in its own shell.

1. In an empty directory named Lab2_PartA, begin by setting up an npm package. When prompted, hit return and select the defaults.
```
npm init     
```
2. We will use Hardhat for development.

```
npm install --save-dev hardhat
```
3. Create an empty Hardhat configuration.
```
npx hardhat init     
```
4. We will develop using the Hardhat plugins from the nomic foundation.
```
npm install --save-dev @nomicfoundation/hardhat-toolbox
```
5. We need to refer to these tools in the config.js file. At top of hardhat.config.js, put the following line:
```
require("@nomicfoundation/hardhat-toolbox");
```
6. Within the directory Lab2_PartA, start a JSON-RPC server that will run on top of the Hardhat Ethereum Virtual Machine. After startup, this server will become available at https://127.0.0.1:8545.
```
npx hardhat node
```
7. Leave this server running in its own shell. Open a new shell and change to the directory Lab2_PartA. Within that shell, create a new subdirectory named scripts.
```
mkdir scripts
```

8. Within the scripts directory [create this Javascript client
named ListAndTransferBalances.js](../../blob/master/Lab2PartA/ListAndTransferBalances.js).

9. Within the project root, i.e., within Lab2_PartA, run the following command
to execute the Javascript code in the scripts directory. Note that we are using the server listening on localhost.
```
npx hardhat run scripts/ListAndTransferBalances.js --network localhost
```

E0. Your server side console should show two transactions. Copy and paste these two
transactions into your single, well labeled pdf file.

E1. How much gas was used by each transaction. Copy and paste your answer into your
single, well labeled pdf file.

E2. How many transactions are being placed into each block. Copy and paste your answer into your
single, well labeled pdf file.

E3. Do the two transactions have the same transaction hash or are they different? Answer this question and copy and paste the two transaction hashes into your single, well labeled pdf file.

E4. Using ListAndTransferBalances.js as a guide, write a new JavaScript program named ShowFirstThreeBalances.js. The program needs to be clean and well documented. Place this program in the scripts directory. Run this program in its own command shell. In your single, well labeled pdf file, show the program itself as well as the output generated. We will name the players Alice, Bob, and Carol. Your output will appear as follows:

Alice balance: ALICE BALANCE HERE

Bob balance: BOB BALANCE HERE

Carol balance: CAROL BALANCE HERE

E5. By examining the shell where the server is running, did the program in E4 generate new
transactions or not? Why? Answer these two questions and copy and paste your answers into your
single, well labeled pdf file.

E6. Modify ListAndTransferBalances.js so that it moves a total of 2000 Eth from Alice to Bob. Run this new
program and then run ShowFirstThreeBalances.js. In your single, well labeled pdf file, show the output generated by ShowFirstThreeBalances.js.


## Part B. Working with an ERC20 Token contract

1. We begin by following the instructions from Lab 1 as repeated here.
2. Create a new project directory named Lab2_PartB.

```
mkdir Lab2_PartB

```
3. Change directory into the new directory.

```
cd Lab2_PartB
```
Build a package.json file (holding important information about this project) by running the command (hit return and take the defaults provided):

```
npm init     

```

4. Now, within the Lab2_PartB directory, install hardhat:

```
npm install --save-dev hardhat

```
5. Next, within the Lab2_PartB directory, initialize Hardhat with the Node Package Execute (npx) command:

```
npx hardhat init
```

You will need to select "Create an empty hardhat.config.js".

6. The npx command creates a hardhat.config.js. In addition, if you are asked to do so,
run the following npm command.

```
npm install --save-dev "hardhat@^2.18.2"

```

7. Within the project directory, install the Hardhat toolbox:

```
npm install --save-dev @nomicfoundation/hardhat-toolbox

```
8. We need access to that toolbox and to establish the correct compiler. Change your
hardhat.config.js so that it reads as follows:

```
require("@nomicfoundation/hardhat-toolbox");
/** @type import('hardhat/config').HardhatUserConfig */
module.exports = {
  solidity: "0.5.14",
};

```
9. Create a new subdirectory named contracts. Within contracts, [create this smart
contract named MyAdvancedToken.sol](../../blob/master/Lab2PartB/MyAdvancedToken.sol).

10. It is very important that you take some time to study the contract before continuing. It
has documentation designed to get you up and running and shows you how to interact with
the contract using the hardhat console.

11. Using Node Package Execute (npx), compile the code with the following command. We do
this in the directory just above the contracts directory.

Note that this command will download the appropriate compiler.

```
npx hardhat compile

```

12. Now, run the console:

```
npx hardhat console
```

13. For the ERC problems, it is highly recommended that you make a copy of each command before executing it. Be sure to save these commands. In this way, if you make a mistake and have to return to the beginning, it is a simple matter to replay the old commands - with copy and paste. This is a big time saver. Many commands may be reused after making small modifications.

14. It is also recommended that you keep track of who owns what as you go.

ERC20 Token Problems

In the problems below, Alice, Bob, Charlie, Donna and Emily are associated
with the first five accounts provided in Hardhat. Each begins with 10,000 ether in his or her account.
Use ethers.getSigners(); to establish these names to accounts.

In some questions, you are asked to show the receipt from a transaction. Here is a common pattern
to get a receipt (and events in the logs).

```
        tx = await token.connect(SomePlayer).someOperation(someParameterList);
        receipt = await tx.wait();
        receipt.logs[0]
```
E7.  Alice has deployed an instance of the MyAdvancedToken contract to
 the blockchain. She gave it the name "Alice Coin" and the symbol AC and an initial
 supply of 1300 tokens.
 Show command(s), that when executed in the Hardhat console, display the number of tokens (Alice Coins) held in her account. For this question you are required to call the balanceOf() method on the contract.

E8. Show the command(s), that when executed in the Hardhat console, display the total supply of tokens. For this question you are required to access the totalSupply public variable.

E9. Alice would like to know her balance in eth. Show the Hardhat console command(s) that will retrieve and display her Ethereum balance in wei and in eth. Note: this is not her token balance. We are looking for two answers here. One showing wei and one showing eth.


E10. Alice allows Bob to spend 100 tokens on her behalf. Show the Hardhat console command(s) and the transaction receipt. Also, show Alice's Ethereum balance (in eth) after she runs the transaction. Note, to view the transaction receipt, you will want to study the documentation on the burn function. While we are not performing a 'burn' activity in this question, you will need the receipt and the event name to answer the next question.

E11. Exercise E10 should have generated an event. Show the three values of _owner, _spender, and _value values that are available. For this answer, you should submit the two hashes and a value. Check your receipt.logs[0].

E12. Alice allows Charlie to spend 50 tokens on her behalf. Show the
Hardhat console command(s) and the transaction receipt. Your receipt.logs[0] should show an approval.

E13. Show the command(s), that when executed in the Hardhat console, display the number of tokens that Alice has in her account. Use the balanceOf() method.

E14. Bob sends 50 of Alice's tokens to Donna. Show the Hardhat console command(s) and the transaction receipt. Also, show Alice's token balance (not eth) after he runs the transaction.


E15. Charlie sends 20 of Alice's tokens to Emily.  Show the Hardhat console command(s) and the transaction receipt. In addition, show Alice's token balance (not eth) after he runs the transaction.

E16. Charlie burns the remaining tokens that he received from Alice. Show the Hardhat console command(s) and the transaction receipt. In addition, since Charlie has burned tokens, show the total supply of tokens that still remain in the contract.

E17. Emily sends 5 of her tokens to Bob. Paste here the
 Hardhat console command(s) and the transaction receipt.
 Also, show Bob's token balance after Emily runs the transaction.


E18. Bob sends his 5 tokens to Alice. Paste here the
 Hardhat console command(s) and the transaction receipt.


E19. Bob returns his remaining allowance to Alice. Show the
 Hardhat console command(s) and the transaction receipt.
 Also, show Bob's token balance after he runs the transaction.


E20. Bob attempts to send 10 tokens to Donna. Show the
 Hardhat console command(s) and the transaction receipt or any errors
 that may occur.


E21. Alice sends 100 tokens to the contract without increasing
 the totalSupply. Paste here the Hardhat console commands and the transaction receipts.


E22. Alice sets the sell price to 1 ether and the buy price to 2 ether.  Note if a player has eth and wants tokens, the player will call 'buy' and pay the buy price. If a player has tokens but wants eth, the player will call 'sell' and sell the tokens at the sell price. Paste here the Hardhat console commands and the transaction receipts.

E23. Show the command(s) to find and display the contract's ether balance (not the token balance).
Show the results in wei and in eth.

E24. Show the commands to find and display Donna's token balance. Show the result.

E25. Donna buys 50 ether worth of tokens. This is the first time that the contract will receive
some cash of its own. Show the Hardhat console command(s) and the transaction receipt.

E26. Show the values of Donna's token balance and the contract's token balance.

E27. Donna no longer enjoys so many tokens and wants to sell 10 back to the contract. Show the Hardhat console command(s) and the transaction receipt. Note, you need to express '10' with 18 zeroes and as a string.

E28. Alice wants to have her contract "live free". So, she turns over control of the contract to the contract itself. Show the command she uses to free her contract and show the returned receipt.

E29. Alice decides that she wants to mint 5 additional tokens and give them to Bob (increasing the total supply of tokens by 5). Show the command that she would try to use and show any error that may result.


E30. Find the token balance of each of our players:

    Alice _________

    Bob   _________

    Charlie _______

    Donna _________

    Emily _________

    contract ______


E31. What is the ether balance of each of our players:

    Alice _________

    Bob   _________

    Charlie _______

    Donna _________

    Emily _________

    contract ______    

## Grading rubric for Lab 2
One pdf file named Lab2.pdf will be submitted on Canvas for grading.

+ 4 points for successful completion of Part A
+ 1 point for correct submission and clear labelings of Part A
+ 4 points for successful completion of Part B
+ 1 point for correct submission and clear labelings of Part B

Penalty for any late  work
==========================
+ -1 point per day late
